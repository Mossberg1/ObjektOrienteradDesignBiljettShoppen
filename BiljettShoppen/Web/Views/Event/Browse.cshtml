@using Models.Enums
@using Models.Entities

@model IEnumerable<Event>

@{
    ViewData["Title"] = "Alla Evenemang";
    var currentEventType = ViewData["CurrentEventType"]?.ToString();
}

<div class="container mt-4">
    <h1 class="mb-4">Alla Evenemang</h1>
    
    <div class="card mb-4">
        <div class="card-header">
            Filtrera Evenemang
        </div>
        <div class="card-body">
            <form asp-controller="Event" asp-action="Browse" method="get">
                <div class="row g-3">
                    <!-- Search Input -->
                    <div class="col-12">
                        <label for="searchString" class="form-label">Sök på evenemang eller arena</label>
                        <input type="text" id="searchString" name="searchString" class="form-control" placeholder="T.ex. Rockkonsert eller Globen..." value="@ViewData["CurrentFilter"]" />
                    </div>

                    <!-- Event Type Dropdown -->
                    <div class="col-md-4">
                        <label for="eventType" class="form-label">Typ av evenemang</label>
                        <select id="eventType" name="eventType" asp-items="Html.GetEnumSelectList<EventType>()" class="form-select">
                            <option value="">Alla typer</option>
                        </select>
                    </div>

                    <!-- Date Filters -->
                    <div class="col-md-4">
                        <label for="fromDate" class="form-label">Från datum</label>
                        <input type="date" id="fromDate" name="fromDate" class="form-control" value="@ViewData["FromDate"]" />
                    </div>
                    <div class="col-md-4">
                        <label for="toDate" class="form-label">Till datum</label>
                        <input type="date" id="toDate" name="toDate" class="form-control" value="@ViewData["ToDate"]" />
                    </div>
                </div>
                <div class="mt-3">
                    <button class="btn btn-primary" type="submit">Filtrera</button>
                    <a asp-action="Browse" class="btn btn-secondary">Rensa filter</a>
                </div>
            </form>
        </div>
    </div>

    <div class="row">
        @foreach (var ev in Model)
        {
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card h-100 shadow-sm">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title">@ev.Name</h5>
                        <h6 class="card-subtitle mb-2 text-muted">
                            @ev.ArenaNavigation.Name - @ev.Date.ToString("d MMMM yyyy")
                        </h6>
                        <p class="card-text flex-grow-1">Hejsan</p>
                        <a href="#" class="btn btn-primary mt-auto">Köp biljetter</a>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        // Set the selected value for the eventType dropdown on page load
        document.addEventListener('DOMContentLoaded', function () {
            const eventType = '@currentEventType';
            if (eventType) {
                document.getElementById('eventType').value = eventType;
            }
        });
    </script>
}